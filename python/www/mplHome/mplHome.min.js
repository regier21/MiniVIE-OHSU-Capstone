var global_motion_class_data=[];function readCsv(t){for(var e=t.split(/\r\n|\n/),n=[],o=0;o<e.length;o++){var m=e[o];if(!("#"===m[0]||m.length<1)){var d=m.split(",");if(0!==n.length){if(d.length===n.length){var s=d[0],a=d[1];global_motion_class_data.push({title:s,href:a,type:"image/"+a.split(".").pop(),thumbnail:a})}}else n=d}}setupGalley(),setupCallbacks()}function routeMessage(t,e){if("sys_status"===t&&($("#msg_status").html(e),$("#msg_status_opt").html(e),$("#msg_status_myo").html(e)),"training_class"===t&&$("#msg_train").text(e),"output_class"===t&&($("#main_output").text(e),$("#mt_output").text(e),$("#tac_output").text(e)),"motion_test_status"===t&&$("#mt_status").html(e),"motion_test_update"===t&&updateMTProgressBar(e),"motion_test_setup"===t&&updateMTImage(e),"TAC_status"===t&&$("#tac_status").html(e),"TAC_setup"===t){var n=e.split(",");n[0]>0&&($("#tacJoint1Name").text(n[1]),updateTACJointTarget(n[2],"tacJoint1Target"),updateTACJointError(n[3],"tacJoint1Target")),n[0]>1&&($("#tacJoint2Name").text(n[4]),updateTACJointTarget(n[5],"tacJoint2Target"),updateTACJointError(n[6],"tacJoint2Target")),n[0]>2&&($("#tacJoint3Name").text(n[7]),updateTACJointTarget(n[8],"tacJoint3Target"),updateTACJointError(n[9],"tacJoint3Target"))}if("TAC_update"===t){var o=e.split(",");o[0]>0&&updateTACJointBar(o[1],"tacJoint1Bar","tacJoint1Label"),o[0]>1&&updateTACJointBar(o[2],"tacJoint2Bar","tacJoint2Label"),o[0]>2&&updateTACJointBar(o[3],"tacJoint3Bar","tacJoint3Label")}if("strNormalizeMyoPosition"===t&&$("#nmp_status").text(e),"strNormalizeMyoPositionImage"===t&&updateNMPImage(e),"joint_cmd"===t){var m=e.split(",");$("#SHFE_Cmd").html(m[0]),$("#SHAA_Cmd").html(m[1]),$("#HUM_Cmd").html(m[2]),$("#EL_Cmd").html(m[3]),$("#WRT_Cmd").html(m[4]),$("#WAA_Cmd").html(m[5]),$("#WFE_Cmd").html(m[6]),$("#1AA_Cmd").html(m[7]),$("#1MCP_Cmd").html(m[8]),$("#1PIP_Cmd").html(m[9]),$("#1DIP_Cmd").html(m[10]),$("#2AA_Cmd").html(m[11]),$("#2MCP_Cmd").html(m[12]),$("#2PIP_Cmd").html(m[13]),$("#2DIP_Cmd").html(m[14]),$("#3AA_Cmd").html(m[15]),$("#3MCP_Cmd").html(m[16]),$("#3PIP_Cmd").html(m[17]),$("#3DIP_Cmd").html(m[18]),$("#4AA_Cmd").html(m[19]),$("#4MCP_Cmd").html(m[20]),$("#4PIP_Cmd").html(m[21]),$("#4DIP_Cmd").html(m[22]),$("#5AA_Cmd").html(m[23]),$("#5CMC_Cmd").html(m[24]),$("#5MCP_Cmd").html(m[25]),$("#5DIP_Cmd").html(m[26])}if("joint_pos"===t){var d=e.split(",");$("#SHFE_Pos").html(d[0]),$("#SHAA_Pos").html(d[1]),$("#HUM_Pos").html(d[2]),$("#EL_Pos").html(d[3]),$("#WRT_Pos").html(d[4]),$("#WAA_Pos").html(d[5]),$("#WFE_Pos").html(d[6]),$("#1AA_Pos").html(d[7]),$("#1MCP_Pos").html(d[8]),$("#1PIP_Pos").html(d[9]),$("#1DIP_Pos").html(d[10]),$("#2AA_Pos").html(d[11]),$("#2MCP_Pos").html(d[12]),$("#2PIP_Pos").html(d[13]),$("#2DIP_Pos").html(d[14]),$("#3AA_Pos").html(d[15]),$("#3MCP_Pos").html(d[16]),$("#3PIP_Pos").html(d[17]),$("#3DIP_Pos").html(d[18]),$("#4AA_Pos").html(d[19]),$("#4MCP_Pos").html(d[20]),$("#4PIP_Pos").html(d[21]),$("#4DIP_Pos").html(d[22]),$("#5AA_Pos").html(d[23]),$("#5CMC_Pos").html(d[24]),$("#5MCP_Pos").html(d[25]),$("#5DIP_Pos").html(d[26])}if("joint_torque"===t){var s=e.split(",");$("#SHFE_Torque").html(s[0]),$("#SHAA_Torque").html(s[1]),$("#HUM_Torque").html(s[2]),$("#EL_Torque").html(s[3]),$("#WRT_Torque").html(s[4]),$("#WAA_Torque").html(s[5]),$("#WFE_Torque").html(s[6]),$("#1AA_Torque").html(s[7]),$("#1MCP_Torque").html(s[8]),$("#1PIP_Torque").html(s[9]),$("#1DIP_Torque").html(s[10]),$("#2AA_Torque").html(s[11]),$("#2MCP_Torque").html(s[12]),$("#2PIP_Torque").html(s[13]),$("#2DIP_Torque").html(s[14]),$("#3AA_Torque").html(s[15]),$("#3MCP_Torque").html(s[16]),$("#3PIP_Torque").html(s[17]),$("#3DIP_Torque").html(s[18]),$("#4AA_Torque").html(s[19]),$("#4MCP_Torque").html(s[20]),$("#4PIP_Torque").html(s[21]),$("#4DIP_Torque").html(s[22]),$("#5AA_Torque").html(s[23]),$("#5CMC_Torque").html(s[24]),$("#5MCP_Torque").html(s[25]),$("#5DIP_Torque").html(s[26])}if("joint_temp"===t){var a=e.split(",");$("#SHFE_Temp").html(a[0]),$("#SHAA_Temp").html(a[1]),$("#HUM_Temp").html(a[2]),$("#EL_Temp").html(a[3]),$("#WRT_Temp").html(a[4]),$("#WAA_Temp").html(a[5]),$("#WFE_Temp").html(a[6]),$("#1AA_Temp").html(a[7]),$("#1MCP_Temp").html(a[8]),$("#1PIP_Temp").html(a[9]),$("#1DIP_Temp").html(a[10]),$("#2AA_Temp").html(a[11]),$("#2MCP_Temp").html(a[12]),$("#2PIP_Temp").html(a[13]),$("#2DIP_Temp").html(a[14]),$("#3AA_Temp").html(a[15]),$("#3MCP_Temp").html(a[16]),$("#3PIP_Temp").html(a[17]),$("#3DIP_Temp").html(a[18]),$("#4AA_Temp").html(a[19]),$("#4MCP_Temp").html(a[20]),$("#4PIP_Temp").html(a[21]),$("#4DIP_Temp").html(a[22]),$("#5AA_Temp").html(a[23]),$("#5CMC_Temp").html(a[24]),$("#5MCP_Temp").html(a[25]),$("#5DIP_Temp").html(a[26])}}function setupCallbacks(){$("#ID_CLEARCLASS").on("mousedown",function(){sendCmd("Cmd:ClearClass")}),$("#ID_CLEARALL").on("mousedown",function(){sendCmd("Cmd:ClearAll")}),$("#ID_TRAIN").on("mousedown",function(){sendCmd("Cmd:Train")}),$("#ID_SAVE").on("mousedown",function(){sendCmd("Cmd:Save")}),$("#ID_BACKUP").on("mousedown",function(){sendCmd("Cmd:Backup")}),$("#ID_SPEEDUP").on("mousedown",function(){sendCmd("Cmd:SpeedUp")}),$("#ID_SPEEDDOWN").on("mousedown",function(){sendCmd("Cmd:SpeedDown")}),$("#ID_HAND_SPEED_UP").on("mousedown",function(){sendCmd("Cmd:HandSpeedUp")}),$("#ID_HAND_SPEED_DOWN").on("mousedown",function(){sendCmd("Cmd:HandSpeedDown")}),$("#ID_MYO1").on("mousedown",function(){sendCmd("Cmd:RestartMyo1")}),$("#ID_MYO2").on("mousedown",function(){sendCmd("Cmd:RestartMyo2")}),$("#ID_SELECT_MYO_SET_1").on("mousedown",function(){sendCmd("Cmd:ChangeMyoSet1")}),$("#ID_SELECT_MYO_SET_2").on("mousedown",function(){sendCmd("Cmd:ChangeMyoSet2")}),$("#ID_RELOAD_ROC").on("mousedown",function(){sendCmd("Cmd:ReloadRoc")}),$("#ID_REBOOT").on("mousedown",function(){sendCmd("Cmd:Reboot")}),$("#ID_SHUTDOWN").on("mousedown",function(){sendCmd("Cmd:Shutdown")}),$("#ID_ASSESSMENT_MT").on("mousedown",function(){startMT()}),$("#ID_ASSESSMENT_MT_STOP").on("mousedown",function(){stopMT()}),$("#ID_NORMALIZE_MYO_POSITION").on("mousedown",function(){startNMP()}),$("#ID_Reset_MYO_POSITION").on("mousedown",function(){sendCmd("Cmd:ResetOrientation")}),$("#ID_ASSESSMENT_TAC1").on("mousedown",function(){startTAC1()}),$("#ID_ASSESSMENT_TAC3").on("mousedown",function(){startTAC3()}),$("#ID_ASSESSMENT_TAC_STOP").on("mousedown",function(){stopTAC()}),$("#ID_GOTO_HOME").on("mousedown",function(){sendCmd("Cmd:GotoHome")}),$("#ID_GOTO_PARK").on("mousedown",function(){sendCmd("Cmd:GotoPark")}),$("#ID_NORMALIZE_UNITY_ORIENTATION").on("mousedown",function(){sendCmd("Cmd:NormUnity")}),$("#ID_MYO_SHUTDOWN_1").on("mousedown",function(){sendCmd("Cmd:ShutdownMyo1")}),$("#ID_MYO_SHUTDOWN_2").on("mousedown",function(){sendCmd("Cmd:ShutdownMyo2")});var t=[],e=[],n=[];t+='<a href="#" class="ui-btn" id="MAN_Stop1">Stop</a>';for(var o=0,m=0;m<global_motion_class_data.length;m++){var d="MAN_"+global_motion_class_data[m].title.replace(/ /g,"_"),s=global_motion_class_data[m].title;if("No Movement"!==s){for(var a=0;e.includes(d);)d+=(a+=1).toString();e.push(d),n.push(s),"Hand Open"!==global_motion_class_data[m].title?0===o?(t+='<fieldset class="ui-grid-a">',t+='<div class="ui-block-a"><a href="#" class="ui-btn" id="'+d+'">'+s+"</a></div>",o+=1):(t+='<div class="ui-block-b"><a href="#" class="ui-btn" id="'+d+'">'+s+"</a></div>",t+="</fieldset>",o=0):t+='<a href="#" class="ui-btn" id="'+d+'">'+s+"</a>"}}t+='<a href="#" class="ui-btn" id="MAN_Stop2">Stop</a>';var _=document.getElementById("ID_MANUAL_CONTROL"),l=document.createElement("div");l.innerHTML=t,_.appendChild(l);for(var u=0;u<e.length;u++)$("#"+e[u]).mousedown("Man:"+n[u],function(t){sendCmd(t.data)});$("#MAN_Stop1").on("mousedown",function(){sendCmd("Man:Stop")}),$("#MAN_Stop2").on("mousedown",function(){sendCmd("Man:Stop")}),$("#trainSwitch").on("change",function(){!0===this.checked?sendCmd("Cmd:Add"):sendCmd("Cmd:Stop")}),$("#precisionMode").on("change",function(){!0===this.checked?sendCmd("Cmd:PrecisionModeOn"):sendCmd("Cmd:PrecisionModeOff")}),$("#pauseAll").on("change",function(){!0===this.checked?sendCmd("Cmd:PauseAllOn"):sendCmd("Cmd:PauseAllOff")}),$("#pauseHand").on("change",function(){!0===this.checked?sendCmd("Cmd:PauseHandOn"):sendCmd("Cmd:PauseHandOff")}),$("#pauseWristFE").on("change",function(){!0===this.checked?sendCmd("Cmd:PauseWristFEOn"):sendCmd("Cmd:PauseWristFEOff")}),$("#resetTorque").on("change",function(){"On"===this.value?sendCmd("Cmd:ResetTorqueOn"):sendCmd("Cmd:ResetTorqueOff")}),$("#enableImpedance").on("change",function(){"On"===this.value?sendCmd("Cmd:ImpedanceOn"):sendCmd("Cmd:ImpedanceOff")}),$("#impedanceLevel").on("change",function(){"Low"===this.value?sendCmd("Cmd:ImpedanceLow"):sendCmd("Cmd:ImpedanceHigh")}),$("#autoSave").on("change",function(){"On"===this.value?sendCmd("Cmd:AutoSaveOn"):sendCmd("Cmd:AutoSaveOff")}),$("#autoOpen").on("change",function(){"On"===this.value?sendCmd("Cmd:AutoOpenOn"):sendCmd("Cmd:AutoOpenOff")}),$("#manualControl").on("change",function(){"On"===this.value?sendCmd("Cmd:ManualControlOn"):sendCmd("Cmd:ManualControlOff")}),$("#streamPercepts").on("change",function(){"On"===this.value?sendCmd("Cmd:JointPerceptsOn"):sendCmd("Cmd:JointPerceptsOff")})}function submitLogMessage(){var t=document.getElementById("ID_LOG_MSG").value;console.log("Logging "+t),sendCmd("Log:"+t)}function startMT(){var t=$("#ID_MT_REPETITIONS").val(),e=$("#ID_MT_TIMEOUT").val(),n=$("#ID_MT_MAX_CLASSIFICATIONS").val();sendCmd("Cmd:StartMotionTester-"+t+"-"+e+"-"+n)}function stopMT(){sendCmd("Cmd:StopMotionTester")}function startNMP(){var t="";document.getElementById("ID_WEO").checked?t="Wrist Extend Out":document.getElementById("ID_EF").checked&&(t="Elbow Flexion"),sendCmd("Cmd:StartNormalizeMyo-"+t)}function startTAC1(){var t=$("#ID_REPETITIONS").val(),e=$("#ID_TIMEOUT").val(),n=$("#ID_DWELL_TIME").val(),o=$("#ID_DEGREE_ERROR").val(),m=$("#ID_GRASP_ERROR").val();sendCmd("Cmd:StartTAC1-"+t+"-"+e+"-"+n+"-"+o+"-"+m)}function startTAC3(){var t=$("#ID_REPETITIONS").val(),e=$("#ID_TIMEOUT").val(),n=$("#ID_DWELL_TIME").val(),o=$("#ID_DEGREE_ERROR").val(),m=$("#ID_GRASP_ERROR").val();sendCmd("Cmd:StartTAC3-"+t+"-"+e+"-"+n+"-"+o+"-"+m)}function stopTAC(){sendCmd("Cmd:StopTAC")}function updateMTProgressBar(t){document.getElementById("mtProgressBar").style.width=t+"%",document.getElementById("mtProgressLabel").innerHTML=1*t+"%"}function updateMTImage(t){document.getElementById("ID_MT_IMAGE").src=t}function updateNMPImage(t){document.getElementById("ID_NMP_IMAGE").src=t}function updateTACJointBar(t,e,n){document.getElementById(e).style.marginLeft=t-2.5+"%",document.getElementById(n).innerHTML=Math.round(1*t).toString()}function updateTACJointError(t,e){document.getElementById(e).style.width=2*t+"%"}function updateTACJointTarget(t,e){var n=document.getElementById(e),o=n.style.width,m=1*t-1*o.substring(0,o.length-1)/2;n.style.marginLeft=m+"%"}$(function(){jQuery.ajax({type:"GET",dataType:"text",url:"./motion_name_image_map.csv",success:function(t){readCsv(t)}})});